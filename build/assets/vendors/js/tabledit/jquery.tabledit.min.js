if("undefined"==typeof jQuery)throw new Error("Tabledit requires jQuery library.");!function(y){"use strict";var C="_TableditData",i={init:function(o){var d=this;if("TABLE"!==d.prop("tagName"))throw new Error("Tabledit only works when applied to a table.");var t=function(t){return void 0!==t||null!==t||""!==t};if(!t(o.columns))return console.log("Tabledit Jquery Plugin not initialize. Set required parameters."),this;t(o.lang)&&o.lang in d.Tabledit.langs?o.lang=o.lang.toLowerCase():o.lang=d.Tabledit.defaults.lang;var r=y.extend({},d.Tabledit.defaults,o);y(this).data(C,y.extend({},d.Tabledit.defaults,o||{}));var u="undefined",b="undefined";if(r.editButton&&r.buttons.edit.html)var l=r.buttons.edit.html;else l=d.Tabledit.langs[r.lang].btn_edit;if(r.deleteButton&&r.buttons.delete.html)var c=r.buttons.delete.html;else c=d.Tabledit.langs[r.lang].btn_delete;if(r.confirmButton&&r.buttons.confirm.html)var f=r.buttons.confirm.html;else f=d.Tabledit.langs[r.lang].btn_confirm;if(r.saveButton&&r.buttons.save.html)var p=r.buttons.save.html;else p=d.Tabledit.langs[r.lang].btn_save;if(r.restoreButton&&r.buttons.restore.html)var h=r.buttons.restore.html;else h=d.Tabledit.langs[r.lang].btn_restore;function m(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"","'":"","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(t).replace(/[&<>"'`=\/]/g,function(t){return e[t]})}function n(l){var t,e,n=d.find(".tabledit-input").serialize();if(!n)return!1;if(n+="&action="+l,!1===(e=r.onAjax(l,n)))return!1;return n=e,r.method=r[l+"method"],y.ajaxSetup({beforeSend:function(t,e){var n;n=e.type,/^(GET|HEAD|OPTIONS|TRACE)$/.test(n)||this.crossDomain||t.setRequestHeader("X-CSRFToken",function(t){var e=null;if(document.cookie&&""!=document.cookie)for(var n=document.cookie.split(";"),i=0;i<n.length;i++){var a=jQuery.trim(n[i]);if(a.substring(0,t.length+1)==t+"="){e=decodeURIComponent(a.substring(t.length+1));break}}return e}("csrftoken"))}}),(t=y.ajax({url:r.url,type:r.method,data:n,dataType:"json"})).done(function(t,e,n){"success"==e?(l===r.buttons.edit.action&&(u.removeClass(r.dangerClass).addClass(r.successClass),setTimeout(function(){d.find("tr."+r.successClass).removeClass(r.successClass)},1500)),r.onSuccess(t,e,n)):r.onFail(e)}),t.fail(function(t,e,n){var i,a,s;l===r.buttons.delete.action?(b.removeClass(r.mutedClass).addClass(r.dangerClass),b.find(".tabledit-toolbar button").attr("disabled",!1),b.find(".tabledit-toolbar .tabledit-restore-button").hide()):l===r.buttons.edit.action&&u.addClass(r.dangerClass),r.onFail(t,exception),o.debug&&console.log((a=e,s=n,(i=t).status?{0:"Not connect. Verify Network.",400:"Server understood the request, but request content was invalid [400].",401:"Unauthorized access [401].",403:"Forbidden resource can not be accessed [403].",404:"Requested page not found. [404]",500:"Internal Server Error [500].",503:"Service unavailable [503]."}[i.status]:"parsererror"==a?"Ajax Error!! Parsing JSON Request failed. \nDetail =>"+a+" : "+s:"timeout"===a?"Time out error.":"abort"===a?"Ajax request aborted.":"Uncaught Error.\n"+i.responseText))}),t.always(function(){r.onAlways()}),t}o.debug&&console.log("Tabledit Init -> Element:",d),o.debug&&console.log("Tabledit Init -> dataPrefix:",C),o.debug&&console.log("Tabledit Init -> Settings: ",r),o.debug&&console.log("Tabledit Init: -----------------------------------");var e={identifier:function(){r.hideIdentifier&&d.find("th:nth-child("+parseInt(r.columns.identifier[0])+"1), tbody td:nth-child("+parseInt(r.columns.identifier[0])+"1)").hide(),d.find('tbody tr:not(".'+r.noEditClass+'") td:not(".'+r.noEditClass+'")').filter(":nth-child("+(parseInt(r.columns.identifier[0])+1)+")").each(function(){var t=y.trim(y(this).text().replace(/^\s+|\s+$/g,"")),e='<span class="tabledit-span tabledit-identifier">'+(t=r.escapehtml?m(t):t)+"</span>",n='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+r.columns.identifier[1]+'" value="'+t+'" disabled>';y(this).html(e+n),y(this).parent("tr").attr(r.rowIdentifier,y.trim(y(this).text()))})},editable:function(){for(var l=0;l<r.columns.editable.length;l++){d.find('tbody tr:not(".'+r.noEditClass+'") td:not(".'+r.noEditClass+'")').filter(":nth-child("+(parseInt(r.columns.editable[l][0])+1)+")").each(function(){var n=y.trim(y(this).text().replace(/(^\s+|\s+$)/g,""));n=r.escapehtml?m(n):n;r.editButton||y(this).css("cursor","pointer");var i,t='<span class="tabledit-span">'+n+"</span>",a=["rows","cols","maxlength","wrap"],e=r.columns.editable[l][2];switch(-1==y.inArray(e,["input","hidden","number","date","select","textarea"])&&(e="input"),e){case"input":i='<input class="tabledit-input '+r.inputClass+'" type="text" name="'+r.columns.editable[l][1]+'" value="'+n+'" style="display: none;" disabled>';break;case"hidden":i='<input class="tabledit-input '+r.inputClass+'" type="hidden" name="'+r.columns.editable[l][1]+'" value="'+n+'" style="display: none;" disabled>';break;case"number":i='<input class="tabledit-input '+r.inputClass+'" type="number" name="'+r.columns.editable[l][1]+'" value="'+n+'" style="display: none;" disabled>';break;case"date":i='<input class="tabledit-input '+r.inputClass+'" type="date" name="'+r.columns.editable[l][1]+'" value="'+n+'" style="display: none;" disabled>';break;case"select":void 0!==r.columns.editable[l][3]&&(i='<select class="tabledit-input '+r.inputClass+'" name="'+r.columns.editable[l][1]+'" style="display: none;" disabled>',y.each(y.parseJSON(r.columns.editable[l][3]),function(t,e){e=y.trim(e),i+=n===e?'<option value="'+t+'" selected>'+e+"</option>":'<option value="'+t+'">'+e+"</option>"}),i+="</select>");break;case"textarea":var s;i="<textarea ",void 0!==r.columns.editable[l][3]?y.each(y.parseJSON(r.columns.editable[l][3]),function(t,e){i+=-1!=y.inArray(t,a)?t+'="'+e+'" ':"",s="maxlength"==t&&0<e.length?d.Tabledit.langs[r.lang].txt_allowchar.replace("%s",e)+' | <span class="countno_"></span> '+d.Tabledit.langs[r.lang].txt_remain:d.Tabledit.langs[r.lang].txt_nolimit}):s=d.Tabledit.langs[r.lang].txt_nolimit,i+=' class="tabledit-input '+r.inputClass+'" name="'+r.columns.editable[l][1]+'" style="display: none;" disabled>'+n+'</textarea><span class="count_" style="display: none;">'+s+"</span>"}y(this).html(t+i),y(this).addClass("tabledit-view-mode")})}},toolbar:function(){if(r.editButton||r.deleteButton){var t="",e="",n="",i="",a="";0===d.find("th.tabledit-toolbar-column").length&&d.find("tr:first").append('<th class="tabledit-toolbar-column '+r.toolbarHeaderClass+'">'+d.Tabledit.langs[r.lang].txt_action+"</th>"),r.editButton&&(t='<button type="button" class="tabledit-edit-button '+r.buttons.edit.class+'" style="float: none;">'+l+"</button>"),r.deleteButton&&(e='<button type="button" class="tabledit-delete-button '+r.buttons.delete.class+'" style="float: none; ">'+c+"</button>",a='<button type="button" class="tabledit-confirm-button '+r.buttons.confirm.class+'" style="display: none; float: none; margin-left: 10px;">'+f+"</button>"),r.editButton&&r.saveButton&&(n='<button type="button" class="tabledit-save-button '+r.buttons.save.class+'" style="display: none; float: none; margin-left: 10px;">'+p+"</button>"),r.deleteButton&&r.restoreButton&&(i='<button type="button" class="tabledit-restore-button '+r.buttons.restore.class+'" style="display: none; float: none; margin-left: 10px;">'+h+"</button>");var s='<div class="tabledit-toolbar '+r.toolbarClass+'" style="text-align: left;flex-wrap: nowrap;">\n                                           <div class="'+r.groupClass+'" style="float: none;">'+t+e+"</div>\n                                           "+n+"\n                                           "+a+"\n                                           "+i+"\n                                       </div></div>";d.find('tbody > tr:not(".'+r.noEditClass+'")').append('<td class="toolbar" style="white-space: nowrap; width: 1%;">'+s+"</td>"),d.find("tbody > tr."+r.noEditClass).append('<td class="toolbar" style="white-space: nowrap; width: 1%;"></td>')}}},i=function(t){var e=y(t).parent("tr");y(t).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0),y(t).find(".tabledit-input").blur().hide().prop("disabled",!0),y(t).find(".count_").hide(),y(t).find(".tabledit-span").show(),y(t).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode"),r.editButton&&(e.find("button.tabledit-save-button").hide(),e.find("button.tabledit-edit-button").removeClass("active").blur())},a=function(t){g.reset(t);var e=y(t).parent("tr");e.find(".tabledit-input.tabledit-identifier").prop("disabled",!1),y(t).find(".tabledit-span").hide();var n=y(t).find(".tabledit-input");n.prop("disabled",!1).show(),y(t).find("textarea").css({resize:"none"}),y(t).find(".count_").css({color:"#CCC",display:"block",float:"right"}).show(),y(t).find(".countno_").html("..."),r.autoFocus&&n.focus(),y(t).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode"),r.editButton&&(e.find("button.tabledit-edit-button").addClass("active"),e.find("button.tabledit-save-button").show())},s=function(t){y(t).each(function(){var t=y(this).find(".tabledit-input"),e=y.trim(y(this).find(".tabledit-span").text());t.is("select")?t.find("option").filter(function(){return y.trim(y(this).text())===e}).attr("selected",!0):t.val(e),i(this)})},v=function(t){!1!==n(r.buttons.edit.action)&&(y(t).each(function(){var t=y(this).find(".tabledit-input");t.is("select")?y(this).find(".tabledit-span").text(y.trim(t.find("option:selected").text())):y(this).find(".tabledit-span").text(t.val()),i(this)}),u=y(t).parent("tr"))},g={reset:function(t){d.find(".tabledit-confirm-button").hide(),d.find(".tabledit-delete-button").removeClass("active").blur()},submit:function(t){g.reset(t),y(t).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var e=n(r.buttons.delete.action);y(t).closest("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==e&&(y(t).parent("tr").addClass("tabledit-deleted-row"),y(t).parent("tr").addClass(r.mutedClass).find(".tabledit-toolbar button:not(.tabledit-restore-button)").attr("disabled",!0),y(t).find(".tabledit-restore-button").show(),b=y(t).parent("tr"))},confirm:function(t){d.find("td.tabledit-edit-mode").each(function(){s(this)}),y(t).find(".tabledit-delete-button").addClass("active"),y(t).find(".tabledit-confirm-button").show()},restore:function(t){y(t).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var e=n(r.buttons.restore.action);y(t).closest("tr").find("input.tabledit-identifier").attr("disabled",!0),!1!==e&&(y(t).parent("tr").removeClass("tabledit-deleted-row"),y(t).parent("tr").removeClass(r.mutedClass).find(".tabledit-toolbar button").attr("disabled",!1),y(t).find(".tabledit-restore-button").hide(),y(t).parent("tr"))}};return e.identifier(),e.editable(),e.toolbar(),r.onDraw(),r.deleteButton&&(d.on("click","button.tabledit-delete-button",function(t){if(!0!==t.handled){t.preventDefault();var e=y(this).hasClass("active"),n=y(this).closest("td");g.reset(n),e||g.confirm(n),t.handled=!0}}),d.on("click","button.tabledit-confirm-button",function(t){if(!0!==t.handled){t.preventDefault();var e=y(this).closest("td");g.submit(e),t.handled=!0}})),r.restoreButton&&d.on("click","button.tabledit-restore-button",function(t){!0!==t.handled&&(t.preventDefault(),g.restore(y(this).closest("td")),t.handled=!0)}),r.editButton?(d.on("click","button.tabledit-edit-button",function(t){if(!0!==t.handled){t.preventDefault();var e=y(this),n=e.hasClass("active");s(d.find("td.tabledit-edit-mode")),n||y(e.closest("tr").find("td.tabledit-view-mode").get().reverse()).each(function(){a(this)}),t.handled=!0}}),d.on("click","button.tabledit-save-button",function(t){!0!==t.handled&&(t.preventDefault(),v(y(this).closest("tr").find("td.tabledit-edit-mode")),t.handled=!0)})):(d.on(r.eventType,"tr:not(.tabledit-deleted-row) td.tabledit-view-mode",function(t){!0!==t.handled&&(t.preventDefault(),s(d.find("td.tabledit-edit-mode")),a(this),t.handled=!0)}),d.on("change","select.tabledit-input:visible",function(t){!0!==t.handled&&(v(y(this).parent("td")),t.handled=!0)}),y(document).on("click",function(t){var e=d.find(".tabledit-edit-mode");e.is(t.target)||0!==e.has(t.target).length||s(d.find(".tabledit-input:visible").parent("td"))})),d.on("keypress",function(t){var e=d.find(".tabledit-input:visible"),n=d.find(".tabledit-confirm-button");if(0<e.length)var i=e.parents("td");else{if(!(0<n.length))return;i=n.parents("td")}switch(t.keyCode){case 9:r.editButton||(v(i),a(i.closest("td").next()));break;case 13:t.preventDefault(),v(i);break;case 27:s(i),g.reset(i)}}),y("textarea").on("change keyup keydown",function(){var t=y(this).val().length,e=y(this).attr("maxlength");if(void 0!==e&&!1!==e&&0<e.length){t=e-t;y(this).parent().find(".countno_").text(t)}}),this},destroy:function(t){t.debug&&console.log("Tabledit Destroy -> Element:",y(this)),this.find(".tabledit-toolbar-column").remove(),this.find(".toolbar").remove(),this.find("td").each(function(){if(0!=y(this).find(".tabledit-input").length)var t=y.trim(y(this).find(".tabledit-span").text());else t=y.trim(y(this).html());y(this).html(t)})},update:function(t){var e=y(this).data(C);if(e){(t=y.extend(!0,e,t)).debug&&console.log("Tabledit Update -> Element:",y(this)),t.debug&&console.log("Tabledit Update -> Settings: ",t);var n=y.parseJSON(JSON.stringify(t,["debug"]));i.destroy.apply(this,[n]),i.init.apply(this,[t])}else console.log("Tabledit Update -> Data: EditTable must be initialized before setting options")}};y.fn.Tabledit=function(t){return i[t]?i[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void y.error("Method "+t+" does not exist on jQuery.Tabledit"):i.init.apply(this,arguments)},y.fn.Tabledit.defaults={url:window.location.href,editmethod:"post",deletemethod:"post",toolbarHeaderClass:"",toolbarClass:"btn-toolbar",groupClass:"btn-group btn-group-sm",inputClass:"form-control input-sm",dangerClass:"danger",successClass:"success",mutedClass:"text-muted",noEditClass:"noedit",eventType:"click",rowIdentifier:"id",hideIdentifier:!1,autoFocus:!0,lang:"en",debug:!1,escapehtml:!0,editButton:!0,deleteButton:!0,saveButton:!0,restoreButton:!0,buttons:{edit:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-pencil"></span>',action:"edit"},delete:{class:"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-trash"></span>',action:"delete"},save:{class:"btn btn-sm btn-success",html:""},restore:{class:"btn btn-sm btn-warning",html:"",action:"restore"},confirm:{class:"btn btn-sm btn-danger",html:"Confirm"}},onDraw:function(){},onSuccess:function(){},onFail:function(){},onAlways:function(){},onAjax:function(){}},y.fn.Tabledit.langs={en:{btn_edit:"Edit",btn_delete:"Delete",btn_confirm:"Confirm",btn_save:"Save",btn_restore:"Restore",txt_action:"Actions",txt_nolimit:"Count of characters without limit",txt_allowchar:"Allowed count of characters %s",txt_remain:"characters remaining"},de:{btn_edit:"Editieren",btn_delete:"L&ouml;schen",btn_confirm:"Best&auml;tigen",btn_save:"Speichern",btn_restore:"Inhalt",txt_action:"Aktion",txt_nolimit:"",txt_allowchar:"",txt_remain:""},fr:{btn_edit:"Editer",btn_delete:"Supprimer",btn_confirm:"Confirmer",btn_save:"Enregistrer",btn_restore:"Restaurer",txt_action:"Actions",txt_nolimit:"Nombre de caractères sans limite",txt_allowchar:"Nombre de caractères autorisés %s",txt_remain:"caractères restants"},cz:{btn_edit:"Editovat",btn_delete:"Odstranit",btn_confirm:"Potvrdit",btn_save:"Uložit",btn_restore:"Obnovit",txt_action:"Akce",txt_nolimit:"Počet znaků bez omezení",txt_allowchar:"Povoleno celkem %s znaků",txt_remain:"znak(ů) zbývá"}}}(jQuery);